<html>
<object style="width: 70px; height: 30px; top: 0px; left: 0px" name="AdaCTI1" id="AdaCTI1"
    classid="clsid:2811E763-1BF2-46E1-B9F0-2BAF799B821B">
    <param name='_Version' value='65536'>
    <param name='_ExtentX' value='3095'>
    <param name='_ExtentY' value='370'>
    <param name='_StockProps' value='0'>
    <param name="Login" value="">
    <param name="Password" value="">
    <param name="LogicalIdentifier" value="">
    <param name="DeviceID" value="">
</object>
<script type="text/javascript">

    var AVAYA = document.getElementById('AdaCTI1');
    function Conecta(NumTelOrigen) {
        try {
            var server = "AVAYA#S8720#CSTA#AESSEVNI"
            var login = "desacti"
            var password = "D3s4ct1&"

            AVAYA.login = login;
            AVAYA.password = password;
            AVAYA.DeviceID = NumTelOrigen;
            AVAYA.LogicalIdentifier = server;
            AVAYA.StartMonitoring();

            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {
                //Eventos de dll
                var TpDisconnected = AVAYA.attachEvent('TpDisconnected', AVAYA_TpDisconnected);
                var TpAnswered = AVAYA.attachEvent('TpAnswered', AVAYA_TpAnswered);
                var OpDisconnected = AVAYA.attachEvent('OpDisconnected', AVAYA_OpDisconnected);
                var Offhook = AVAYA.attachEvent('Offhook', AVAYA_Offhook);
                var MonitoringStopped = AVAYA.attachEvent('MonitoringStopped', AVAYA_MonitoringStopped);
                var InboundCall = AVAYA.attachEvent('InboundCall', AVAYA_InboundCall);
                var Failure = AVAYA.attachEvent('Failure', AVAYA_Failure);
                var OpAnswered = AVAYA.attachEvent('OpAnswered', AVAYA_OpAnswered);
            }

        }
        catch (err) {
            alert(err);
        }
    }

    //Eventos - Parametros dll
    function AVAYA_TpDisconnected(CallRefID, OldCallRefID, SecOldCallRefID) {

        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {

            }
        } catch (err) {
            alert(err);
        }
    }

    function AVAYA_TpAnswered(CallRefID, CallingDevice, LastRedirectionDevice, CalledNumber) {
        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {
                document.getElementById('txtCallingNumber').value = CallingDevice;
                document.getElementById('txtCallNumber').value = CalledNumber;
                document.getElementById('frmCMGenerico').src = "https://www.google.com.mx";

            }
        } catch (err) {
            alert(err);
        }
    }

    function AVAYA_OpDisconnected(CallRefID, DisconnectingDevice) {
        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {

            }
        } catch (err) {
            alert(err);
        }
    }

    function AVAYA_Offhook(CallRefID, CalledNumber) {
        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {

            }
        } catch (err) {
            alert(err);
        }
    }

    function AVAYA_MonitoringStopped(Reason) {
        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {

            }
        } catch (err) {
            alert(err);
        }
    }

    function AVAYA_InboundCall(CallRefID, CallingNumber, LastRedirectionDevice, CalledNumber) {
        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {

            }
        } catch (err) {
            alert(err);
        }
    }

    function AVAYA_Failure(Reason) {
        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {

            }
        } catch (err) {
            alert(err);
        }
    }

    function AVAYA_OpAnswered(CallRefID, AnsweringDevice, LastRedirectionDevice, CalledNumber) {
        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {

            }
        } catch (err) {
            alert(err);
        }
    }

    //Funciones
    function TerminaMonitoreo() {
        try {
            if (typeof (AVAYA) === 'undefined' || AVAYA === null) {
                alert('Unable to load ActiveX');
            }
            else {
                AVAYA.StopMonitoring();
            }
        } catch (err) {
            alert(err);
        }
    }
    function call() {
        try {

            if (document.getElementById('txtPhone').value != "") {
                AVAYA.MakeCall(document.getElementById('txtPhone').value);
            }
            else {
                alert("Necesita ingresar parametros en la extension de marcado");
                document.getElementById('txtPhone').focus();
                return;
            }
        } catch (err) {
            alert(err);
        }
    }
    function hangup() {
        try {
            AVAYA.HangupCall();
        } catch (e) {
            alert(e.ToString());
        }
    }
    function callingfortransfer() {
        try {
            if (document.getElementById('txtPhone').value != "") {
                AVAYA.HoldCall();
                AVAYA.MakeCall(document.getElementById('txtPhone').value);
                setTimeout(executetransfer, 2000);
            }
            else {
                alert("Necesita ingresar parametros en la extension a transferir");
                document.getElementById('txtPhone').focus();
                return;
            }
        } catch (e) {
            alert(e.ToString());
        }
    }
    function executetransfer() {
        try {
            AVAYA.TransferCall();
            AVAYA.HangupCall();
        } catch (e) {
            alert(e.ToString());
        }
    }
    function callingconference() {
        try {
            if (document.getElementById('txtPhone').value != "") {
                AVAYA.HoldCall();
                AVAYA.MakeCall(document.getElementById('txtPhone').value);
                setTimeout(executeconference, 2000);
            }
            else {
                alert("Necesita ingresar parametros en la extension para la conferencia");
                document.getElementById('txtPhone').focus();
                return;
            }

        } catch (e) {
            alert(e.ToString());
        }
    }
    function executeconference() {
        try {
            AVAYA.ConferenceJoin();
        } catch (e) {
            alert(e.ToString());
        }
    }
    function answer() {
        try {
            AVAYA.AnswerCall();
        } catch (e) {
            alert(e.ToString());
        }
    }
    function OcultarControles() {
        document.getElementById("lblCallingnumber").style.display = "none";
        document.getElementById("txtCallingNumber").style.display = "none";
        document.getElementById("lblCallnumber").style.display = "none";
        document.getElementById("txtCallNumber").style.display = "none";
        document.getElementById("btnColgar").style.display = "none";
        document.getElementById("btnAswered").style.display = "none";
        document.getElementById("lblPhone").style.display = "none";
        document.getElementById("txtPhone").style.display = "none";
        document.getElementById("btnMacar").style.display = "none";
        document.getElementById("btnTransferir").style.display = "none";
        document.getElementById("btnConferencia").style.display = "none";

        alert("Ocurrio un problema para la conexion con la telefonia validelo con su administrador de sistema")
    }

    //    Funciones de validaciones
    function ValidarNumeros(e) {
        var key;
        if (window.event) // IE
        {
            key = e.keyCode;
        }
        else if (e.which) // Netscape/Firefox/Opera
        {
            key = e.which;
        }

        if (key < 48 || key > 57) {
            if (key == 46 || key == 8 || key == 9 || key == 17 || key == 46 || key == 13) // Detectar . (punto) y backspace (retroceso)
            { return true; }
            else
            { return false; }
        }
        return true;
    }

    function ValidarLetras(e) {
        var key;
        if (window.event) // IE
        {
            key = e.keyCode;
        }
        else if (e.which) // Netscape/Firefox/Opera
        {
            key = e.which;
        }

        if ((key >= 65 && key <= 90) || (key >= 97 && key <= 122) || (key >= 192 && key <= 255) || key == 46 || key == 8 || key == 32 || key == 64 || key == 45 || key == 95 || key == 9 || key == 17 || key == 46 || key == 13) {
            return true;
        }
        else { return false; }
        return true;
    }

    function ValidarNumerosYLetras(e) {
        var key;
        if (window.event) // IE
        {
            key = e.keyCode;
        }
        else if (e.which) // Netscape/Firefox/Opera
        {
            key = e.which;
        }

        if ((key >= 48 && key <= 57) || (key >= 65 && key <= 90) || (key >= 97 && key <= 122) || (key >= 192 && key <= 255) || key == 46 || key == 8 || key == 32 || key == 64 || key == 45 || key == 95 || key == 9 || key == 17 || key == 46 || key == 13) {
            return true;
        }
        else { return false; }
        return true;
    }

    function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
            vars[key] = value;
        });
        return vars;
    }
</script>
<body onload="Conecta(85477)" onunload="TerminaMonitoreo()">
    <table style="width: 100%">
        <tr>
            <td colspan="3">
                <label id="lblCallingNumber">
                    Calling Number:</label>
                <input type="text" id="txtCallingNumber" maxlength="15" disabled maxlength="15" style="width: 120px;
                    direction: ltr;" />
                <br />
                <label id="lblCallNumber">
                    Call Number:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="txtCallNumber"
                        maxlength="15" disabled maxlength="15" style="width: 120px; direction: ltr;" />
            </td>
            <td colspan="3" align="center">
                <label id="lblPhone">
                    Phone:</label><input type="text" id="txtPhone" maxlength="15" style="width: 120px;
                        direction: ltr;" />
            </td>
        </tr>
        <tr>
            <td align="center">
                <input type="button" id="btnConecta" onclick="Conecta(36847);" value="Conecta" />
            </td>
            <td align="center">
                <input type="button" id="btnAswered" onclick="answer();" value="Contestar" />
            </td>
            <td>
                <input type="button" id="btnColgar" onclick="hangup();" value="Colgar" />
            </td>
            <td>
                <input type="button" id="btnMacar" onclick="call();" value="Marcar" />
            </td>
            <td>
                <input type="button" id="btnTransferir" onclick="callingfortransfer();" value="Transferir" />
            </td>
            <td>
                <input type="button" id="btnConferencia" onclick="callingconference();" value="Conferencia" />
            </td>
        </tr>
    </table>
    <iframe id="frmCMGenerico" src="http://localhost/engine.html?serviciosId=1&skillId=1&clientesId=1&usuarioId=12#" width="100%" height="100%"></iframe>
</body>
</html>
